<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Amit Arora">
<meta name="description" content="Analyze Big Data using cloud computing and technologies such as Apache Spark">

<title>Docker – DSAN 6000</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../files/img/dsan6000-logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-N2B9K684GE"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-N2B9K684GE', { 'anonymize_ip': true});
</script>


<meta property="og:title" content="Docker – DSAN 6000">
<meta property="og:description" content="">
<meta property="og:image" content="https://aa1603.georgetown.edu/dsan6000/labs/files/img/dsan6000-logo.png">
<meta property="og:site_name" content="DSAN 6000">
<meta property="og:locale" content="en_US">
<meta name="twitter:title" content="Docker – DSAN 6000">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://aa1603.georgetown.edu/dsan6000/labs/files/img/dsan6000-logo.png">
<meta name="twitter:creator" content="@aarora79">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">DSAN 6000</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../content/index.html"> 
<span class="menu-text">Content</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../labs/index.html"> 
<span class="menu-text">Labs</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-project" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Project</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-project">    
        <li>
    <a class="dropdown-item" href="../project/index.html">
 <span class="dropdown-text">Project</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../project/project-on-azure.html">
 <span class="dropdown-text">Using AzureML</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-technical-reference" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Technical Reference</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-technical-reference">    
        <li>
    <a class="dropdown-item" href="../tech-ref/terminal-and-ssh.html">
 <span class="dropdown-text">Terminal and SSH keys</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tech-ref/azure.html">
 <span class="dropdown-text">Microsoft Azure</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../resources/index.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://dsan6000fall2024.slack.com"> <i class="bi bi-slack" role="img" aria-label="Slack">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#part-1--lambda" id="toc-part-1--lambda" class="nav-link active" data-scroll-target="#part-1--lambda">Part-1- Lambda</a></li>
  <li><a href="#lambda-basics" id="toc-lambda-basics" class="nav-link" data-scroll-target="#lambda-basics">Lambda Basics</a>
  <ul class="collapse">
  <li><a href="#hello-world-lambda" id="toc-hello-world-lambda" class="nav-link" data-scroll-target="#hello-world-lambda">“Hello World” Lambda</a></li>
  <li><a href="#exploring-the-lambda-file-system---lab-submission-component" id="toc-exploring-the-lambda-file-system---lab-submission-component" class="nav-link" data-scroll-target="#exploring-the-lambda-file-system---lab-submission-component">Exploring the Lambda File System - <strong>LAB SUBMISSION COMPONENT</strong></a></li>
  <li><a href="#part-2--cloud9" id="toc-part-2--cloud9" class="nav-link" data-scroll-target="#part-2--cloud9">Part-2- Cloud9</a></li>
  </ul></li>
  <li><a href="#cloud9-setup" id="toc-cloud9-setup" class="nav-link" data-scroll-target="#cloud9-setup">Cloud9 Setup</a>
  <ul class="collapse">
  <li><a href="#creating-cloud9-environment" id="toc-creating-cloud9-environment" class="nav-link" data-scroll-target="#creating-cloud9-environment">Creating Cloud9 Environment</a></li>
  <li><a href="#part-3--docker-lambda" id="toc-part-3--docker-lambda" class="nav-link" data-scroll-target="#part-3--docker-lambda">Part-3- Docker-Lambda</a></li>
  <li><a href="#setting-up-basic-docker-images-in-cloud9" id="toc-setting-up-basic-docker-images-in-cloud9" class="nav-link" data-scroll-target="#setting-up-basic-docker-images-in-cloud9">Setting up Basic Docker Images in Cloud9</a></li>
  <li><a href="#lambda-docker-imagelab-demonstration" id="toc-lambda-docker-imagelab-demonstration" class="nav-link" data-scroll-target="#lambda-docker-imagelab-demonstration">Lambda Docker Image(Lab-Demonstration)</a></li>
  </ul></li>
  <li><a href="#lambda-yahoo-finance-exercise-lab-submission-part-2" id="toc-lambda-yahoo-finance-exercise-lab-submission-part-2" class="nav-link" data-scroll-target="#lambda-yahoo-finance-exercise-lab-submission-part-2">Lambda Yahoo Finance Exercise (LAB Submission-Part-2)</a>
  <ul class="collapse">
  <li><a href="#python-setup" id="toc-python-setup" class="nav-link" data-scroll-target="#python-setup">Python Setup</a></li>
  <li><a href="#coding-requirements" id="toc-coding-requirements" class="nav-link" data-scroll-target="#coding-requirements">Coding Requirements:</a></li>
  </ul></li>
  <li><a href="#deploying-docker-container-as-a-lambda-function" id="toc-deploying-docker-container-as-a-lambda-function" class="nav-link" data-scroll-target="#deploying-docker-container-as-a-lambda-function">Deploying Docker Container as a Lambda Function</a>
  <ul class="collapse">
  <li><a href="#posting-docker-image-to-ecr" id="toc-posting-docker-image-to-ecr" class="nav-link" data-scroll-target="#posting-docker-image-to-ecr">Posting Docker Image to ECR</a></li>
  <li><a href="#docker-setup-in-lambda" id="toc-docker-setup-in-lambda" class="nav-link" data-scroll-target="#docker-setup-in-lambda">Docker Setup in Lambda</a></li>
  </ul></li>
  <li><a href="#set-up-function-url-for-a-rest-api" id="toc-set-up-function-url-for-a-rest-api" class="nav-link" data-scroll-target="#set-up-function-url-for-a-rest-api">Set up Function URL for a REST API</a>
  <ul class="collapse">
  <li><a href="#submit-the-lambda-url-in-lambda-docker-url.json-file.-make-sure-that-if-a-payload-is-given-from-the-local-terminal-in-your-laptop-the-lambda-function-returns-the-intended-result." id="toc-submit-the-lambda-url-in-lambda-docker-url.json-file.-make-sure-that-if-a-payload-is-given-from-the-local-terminal-in-your-laptop-the-lambda-function-returns-the-intended-result." class="nav-link" data-scroll-target="#submit-the-lambda-url-in-lambda-docker-url.json-file.-make-sure-that-if-a-payload-is-given-from-the-local-terminal-in-your-laptop-the-lambda-function-returns-the-intended-result.">** Submit the Lambda URL in <code>lambda-docker-url.json</code> file. Make sure that if a payload is given from the local terminal in your laptop, the lambda function returns the intended result.**</a></li>
  </ul></li>
  <li><a href="#run-unit-tests-of-your-rest-api" id="toc-run-unit-tests-of-your-rest-api" class="nav-link" data-scroll-target="#run-unit-tests-of-your-rest-api">Run Unit Tests of your REST API</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header">
<h1 class="title display-7">Docker</h1>

</header>


<section id="part-1--lambda" class="level2">
<h2 class="anchored" data-anchor-id="part-1--lambda">Part-1- Lambda</h2>
</section>
<section id="lambda-basics" class="level1">
<h1>Lambda Basics</h1>
<p>Lambda is a powerful tool to build serverless microfunctions in a variety of programming languages. These microfunctions can be triggered in a variety of ways, including time, text message, web traffic, or even voice commands. The execution of a Lambda can scale to meet the burst needs of users going to a website, or the number of rows of incoming data. There can be thousands of executions happening simultaneously. Lambda is billed by the millisecond (ms).</p>
<section id="hello-world-lambda" class="level2">
<h2 class="anchored" data-anchor-id="hello-world-lambda">“Hello World” Lambda</h2>
<p>Launch AWS Academy and get to the AWS Console. Find the Lambda service from the search bar. <a href="img/lambda-0.PNG"><img src="img/lambda-0.PNG" class="img-fluid"></a></p>
<p>The dashboard shows the Lambda functions that have been made, some metrics on Lambda usage. Click on the orange <code>Create Function</code> button.</p>
<p><a href="img/lambda-dashboard.jpg"><img src="img/lambda-dashboard.jpg" class="img-fluid"></a></p>
<p>Here you have to fill out the details for your Lambda function. There are several parts to set up.</p>
<ol type="1">
<li><p>You will leave the default option <code>Author from scratch</code> so that you can code directly from the Lambda service.</p></li>
<li><p>Set your <code>Function name</code> as <code>test-lambda</code>.</p></li>
<li><p>Choose your <code>Runtime</code> as <code>Python 3.11</code></p></li>
<li><p>Click on the <code>Change default execution role</code> dropdown, then select <code>Use an existing role</code> option, and finally pick the existing role <code>LabRole</code>.</p></li>
</ol>
<p><a href="img/lambda-1.PNG"><img src="img/lambda-1.PNG" class="img-fluid"></a></p>
<ol type="1">
<li>Under <code>Advanced Settings</code> check the <code>Enable Function URL</code> checkbox and select <code>None</code> for Auth type. This will create an HTTPS endpoint that you can access from your web browser or <code>cURL</code> command without authentication (in a real world scenario the authentication piece is usually handled by an <code>API Gateway</code>).</li>
</ol>
<p><a href="img/lambda-advanced-settings.png"><img src="img/lambda-advanced-settings.png" class="img-fluid"></a></p>
<ol type="1">
<li>Now click on the orange <code>Create function</code> button.</li>
</ol>
<p>You now have your environment for Lambda! In the upper function overview tab, you can select a variety of triggers and destinations for the Lambda. We will leave these alone for now. You can explore both on your own time to see the options.</p>
<p><a href="img/lambda-2.PNG"><img src="img/lambda-2.PNG" class="img-fluid"></a></p>
<p>Let’s start with the basic test of the “Hello World” code that was provided in the Python code. Click on the blue <code>Test</code> button.</p>
<p><a href="img/lambda-3-w-url.PNG"><img src="img/lambda-3-w-url.PNG" class="img-fluid"></a></p>
<p>This will launch a popup to configure your event. You can submit a JSON payload to the test that will mimic input data that the Lambda function can process. Start off by setting <code>Event name</code> to <code>mytest</code>. Then you can leave the <code>Event JSON</code> for now, but you will come back to it for future iterations of experimentation. Click on the orange <code>save</code> button.</p>
<p><a href="img/lambda-4.PNG"><img src="img/lambda-4.PNG" class="img-fluid"></a></p>
<p>Click on the blue <code>Test</code> button again. If you click on the arrow then you can choose to change or make a new test environment like you did on the previous step.</p>
<p><a href="img/lambda-5.PNG"><img src="img/lambda-5.PNG" class="img-fluid"></a></p>
<p>Your test will execute, and the results will be shown. Several pieces of info are important:</p>
<ul>
<li>Name of the test that was conducted</li>
<li>Response object that the function returned</li>
<li>Function logs that include the duration of the function, billed direction, memory max (for pricing), and actual memory used</li>
<li>Status in the upper right</li>
</ul>
<p><a href="img/lambda-6.PNG"><img src="img/lambda-6.PNG" class="img-fluid"></a></p>
<p>You are now ready to invoke your newly deployed Lambda function through your web browser or through <code>cURL</code>. Copy the function URL and paste it in your browser’s address bar.</p>
<p><a href="img/lambda-browser.jpg"><img src="img/lambda-browser.jpg" class="img-fluid"></a></p>
<p>Now try invoking the Lambda from a <code>cURL</code> command (this requires <code>cURL</code> to be available on your machine).</p>
<p><a href="img/lambda-curl.jpg"><img src="img/lambda-curl.jpg" class="img-fluid"></a></p>
<p>OPTIONAL - If you wanted to set your Lambda to run on a regular schedule, like a crontab, you would add a trigger with the <code>Add trigger</code> button in the Function Overview and select <code>EventBridge (CloudWatch Events)</code>. The Trigger add would look like this for setting a job to run every day at 10:15am UTC.</p>
<p><a href="img/lambda-trigger-cron.PNG"><img src="img/lambda-trigger-cron.PNG" class="img-fluid"></a></p>
</section>
<section id="exploring-the-lambda-file-system---lab-submission-component" class="level2">
<h2 class="anchored" data-anchor-id="exploring-the-lambda-file-system---lab-submission-component">Exploring the Lambda File System - <strong>LAB SUBMISSION COMPONENT</strong></h2>
<p>In this section, you will a make use of AWS Lambda to see how serverless infrastructure works. For this assignment, you will need to submit a set of JSON files along with other required files.</p>
<p>In AWS Lambda, for an output to be generated, you will may use <code>json.dumps</code> to dump a dictionary to the <code>body</code> value in the return statement. This is one of many methods you can use! We encourage you to experiment with few different methods and choose what works the best given your case. A screenshot is attached below for reference. Also note that <code>indent=2</code> argument for <code>json.dumps</code>, it comes in handy for producting a pretty printed output.</p>
<p>A dictionary is basically defined as a key:value pair, this is also the building block of json format.</p>
<p>Each time you make a change to the code, you will have to click on the <code>Deploy</code> button and then the blue <code>Test</code> button.</p>
<blockquote class="blockquote">
<p>Note the use of the <code>dict</code> constructor for creating the dictionary. This is an alternate, more readable (arguably slower though) way of creating a Python dictionary. Also note that <code>indent=2</code> argument for <code>json.dumps</code>, it comes in handy for producting a pretty printed output.</p>
</blockquote>
<p><a href="img/lambda-body.png"><img src="img/lambda-body.png" class="img-fluid"></a></p>
<ol type="1">
<li>Use the <code>pathlib</code> library and its <code>iterdir()</code> method in Python to view the contents of the root directory (the <code>/</code> is referred to as the <code>root</code> directory). Make a new key in the Lambda called <code>root</code> in the return JSON and send the contents of the root directory. This might take a few tries! How do you deal with objects that need to become strings?</li>
</ol>
<blockquote class="blockquote">
<p>Hint!: Think how you can pass objects in a string? For this you can use something like this:</p>
</blockquote>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ss">f'string here </span><span class="sc">{</span><span class="bu">object</span><span class="sc">}</span><span class="ss">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li><p>Return the contents of the event input variable to the lambda_handler function as additional item in the return JSON as <code>event</code>.</p></li>
<li><p>Return the python version using the <code>executable()</code> method in the <code>sys</code> library. The key should be <code>py_version</code>.</p></li>
<li><p>Return the current username using the <code>subprocess</code> library and the <code>whoami</code> shell command. The key should be <code>username</code>.</p></li>
<li><p>Note that all the new keys you are adding to the response should be nested as part of the <code>body</code>. So essentially, the response contains of two keys: a <code>statusCode</code> which specifies if the call successed or failed (a statusCode value other than 200 indicates a failure) and a <code>body</code> key which has the contents of the response.</p></li>
</ol>
<p>After these have been executed, copy the function URL and put it in <code>lambda-test-url.json</code></p>
<p>The response from the server should be like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>{ <span class="st">"statusCode"</span>: <span class="dv">200</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"body"</span>: {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"message"</span>: <span class="st">"Hello from Lambda!"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"root"</span>: <span class="st">"..."</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"event"</span>: <span class="st">"..."</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"py_version"</span>: <span class="st">"..."</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"username"</span>: <span class="st">"..."</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="part-2--cloud9" class="level2">
<h2 class="anchored" data-anchor-id="part-2--cloud9">Part-2- Cloud9</h2>
</section>
</section>
<section id="cloud9-setup" class="level1">
<h1>Cloud9 Setup</h1>
<p>Follow these instructions <em>step-by-step</em> to setup your Cloud9 in AWS. The screenshots may look a bit different than what you are seeing, but the flow is the same.</p>
<section id="creating-cloud9-environment" class="level2">
<h2 class="anchored" data-anchor-id="creating-cloud9-environment">Creating Cloud9 Environment</h2>
<ol type="1">
<li>Search for <code>cloud9</code> in the search bar of your AWS console as shown in the figure below.</li>
</ol>
<p><a href="img/cloud9_step0.PNG"><img src="img/cloud9_step0.PNG" class="img-fluid"></a></p>
<ol start="2" type="1">
<li>Once on the Cloud9 splash screen, click on the orange button <code>Create environment</code>.</li>
</ol>
<p><a href="img/cloud9_step1.PNG"><img src="img/cloud9_step1.PNG" class="img-fluid"></a></p>
<ol start="3" type="1">
<li>Enter a Name for your environment. Leave the description blank. The figure below shows sample text you could use. Once you enter your name, scroll down to the next section.</li>
</ol>
<p><a href="img/cloud9_step2.PNG"><img src="img/cloud9_step2.PNG" class="img-fluid"></a></p>
<ol start="4" type="1">
<li>There are a few options here. You have to make a few changes.
<ul>
<li>The <strong>Instance type</strong> section is to select how large an instance for Cloud9. <strong>Select the <code>t3.small</code> instance type</strong></li>
<li>The <strong>Platform</strong> section is for selecting the operating system for your new instance. <strong>Leave as the default</strong></li>
<li>The <strong>Timeout</strong> option is set so your instance will hibernate after 30 minutes so you are not charged for the instance 24/7. This is a major problem for cloud services because you can run up a bill quite quickly! <strong>Leave as the default</strong></li>
<li>In Network Settings, <strong>Connection</strong> is how to connect to your instance. <strong>Select <code>Secure Shell (SSH)</code></strong></li>
<li>Finally, click the orange button <code>Create</code></li>
</ul></li>
</ol>
<p><a href="img/cloud9_step3.PNG"><img src="img/cloud9_step3.PNG" class="img-fluid"></a></p>
<ol start="5" type="1">
<li>You will be sent to the environments page of the Cloud9 service. Your environment is now building. In the table below, for your environment (the row), click on the <code>Open</code> button in Cloud9 IDE column. In the screenshot, we named it <code>cloud9-env</code>.</li>
</ol>
<p><a href="img/cloud9_step4.PNG"><img src="img/cloud9_step4.PNG" class="img-fluid"></a></p>
<ol start="6" type="1">
<li>The environment will be configured for you. This takes a few minutes.</li>
</ol>
<p><a href="img/cloud9_step5.PNG"><img src="img/cloud9_step5.PNG" class="img-fluid"></a></p>
<p>Once the environment setup screen goes away then you are ready to use Cloud9. If you get a warning message, just click “OK”.</p>
</section>
<section id="part-3--docker-lambda" class="level2">
<h2 class="anchored" data-anchor-id="part-3--docker-lambda">Part-3- Docker-Lambda</h2>
</section>
<section id="setting-up-basic-docker-images-in-cloud9" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-basic-docker-images-in-cloud9">Setting up Basic Docker Images in Cloud9</h2>
<div class="callout-important:">
<p><strong><em>This lab will take a lot of time! You will need atleast 5-6 hours on average to work on this lab. Please make sure you start this assignment as soon as possible</em></strong></p>
</div>
<p>Docker image building in Cloud9 is easy since the docker package is already set up. You just have to write some code and run Linux commands!</p>
<ul>
<li><p>In Cloud9, start off by cloning your git repository from either the source control button on the lefthand sidebar or through the terminal.</p></li>
<li><p>In the root of your repository, create three empty text files in that folder called <code>Dockerfile</code>, <code>app.py</code>, and <code>requirements.txt</code>.</p></li>
<li><p>The results should look like below and have the symbols change automatically:</p></li>
</ul>
<p><img src="img/cloud9-docker-empty-files.png" class="img-fluid"></p>
<ul>
<li>Open up the <code>Dockerfile</code> and add the following text (note the # lines are comments just like python!)</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># syntax=docker/dockerfile:1</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># adapted from https://www.philschmid.de/aws-lambda-with-custom-docker-image</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># https://docs.aws.amazon.com/lambda/latest/dg/python-image.html</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>FROM python:<span class="fl">3.11</span><span class="op">-</span>slim<span class="op">-</span>buster</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>CMD [<span class="st">"python"</span>, <span class="st">"-c"</span>, <span class="st">"import platform; print(f</span><span class="ch">\"</span><span class="st">version: {platform.python_version()}</span><span class="ch">\"</span><span class="st">)"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Go to the terminal and change directories to the location of your Dockerfile. Run the command <code>docker build ./ -t test</code></li>
</ul>
<p><img src="img/cloud9-docker-test-build.PNG" class="img-fluid"></p>
<ul>
<li>Run the command <code>docker run test</code> to see if your Dockerfile worked!</li>
</ul>
<p><img src="img/cloud9-docker-test-run.PNG" class="img-fluid"></p>
</section>
<section id="lambda-docker-imagelab-demonstration" class="level2">
<h2 class="anchored" data-anchor-id="lambda-docker-imagelab-demonstration">Lambda Docker Image(Lab-Demonstration)</h2>
<p>Note that this Dockerfile is invoking your <code>requirements.txt</code> file to install any packages from pip and the app.py lambda_handler function to run the python code.</p>
<blockquote class="blockquote">
<p>Now you might think how does this <code>requirements.txt</code> file work? Each library which needs to be installed will be listed here. Think of Docker as a virtual environment where you can install any package you need and then you would list them in the <code>requirements.txt</code> file. A small example of this is given in the following screenshot below. When the requirements.txt file has been changed, you will have to build and redeploy the docker image.</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/requirements-example.png" class="img-fluid figure-img"></p>
<figcaption>requirements.txt</figcaption>
</figure>
</div>
<ul>
<li>Use the new Dockerfile contents below for your <code>Dockerfile</code>.</li>
</ul>
<p>A few examples of how to build a docker file along with some documentation is given below in this link: https://spacelift.io/blog/dockerfile. You can scroll down to see how a docker commands work and what they do. This will be useful in making this a relatively simple task.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># syntax=docker/dockerfile:1</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># adapted from https://www.philschmid.de/aws-lambda-with-custom-docker-image</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># https://docs.aws.amazon.com/lambda/latest/dg/python-image.html</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>FROM public.ecr.aws<span class="op">/</span><span class="kw">lambda</span><span class="op">/</span>python:<span class="fl">3.11</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">##### copy requirements file and install necessary packages</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ***CODE TO DO***</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD the requirements.txt into the ${LAMBDA_TASK_ROOT} directory in the container</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>RUN pip3 install <span class="op">-</span>r ${LAMBDA_TASK_ROOT}<span class="op">/</span>requirements.txt <span class="op">--</span>target <span class="st">"$</span><span class="sc">{LAMBDA_TASK_ROOT}</span><span class="st">"</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">##### Copy function code to docker container</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ***CODE TO DO***</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD the app.py file into the ${LAMBDA_TASK_ROOT} directory in the container</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">##### SET THE COMMAND OF THE CONTAINER FOR THE LAMBDA HANDLER</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># app (name of py file)</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># handler (name of function to execute for lambda job)</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>CMD [ <span class="st">"app.lambda_handler"</span> ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>Note that the ADD and COPY commands in Docker for this instance are similar. The ADD function is more advanced and can auto-extract compressed files into the image. Please use the given python version for this assignment. This assignment was mainly designed to be used with python 3.11. If you a version of python which is lower, we cannot say if it would be compatible.</p></li>
<li><p>Set up your python file <code>app.py</code> with a function called <code>lambda_handler</code> that accepts the <code>event</code> and <code>context</code> arguments. Wait, we have already done this in basic Lambda! <strong><em>Copy your function from the Lambda service.</em></strong> This will ensure that the response is the same through basic Lambda and through the Docker Lambda.</p></li>
<li><p>Since you made changes to the Dockerfile and your app.py files, you need to build a new Docker image. Run the command <code>docker build ./ -t lambda-test</code> so that you name the image something new.</p></li>
<li><p>This has to be done every time you make changes to the <code>app.py</code> file or the <code>Dockerfile</code>.</p></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The syntax of <code>docker build</code> is as follows:</p>
<pre class="bashrc"><code>docker build PATH -t 'CONTAINER NAME'

#Container name can be changed in this instance, but lambda-test is preferred.
#  -t is a flag which tags the container with a name 
#  In the above command, ./ is the path where the container would be built. 
#  Can you recall where does ./ lead to?
</code></pre>
</div>
</div>
<div class="callout-hint">
<p>Try running the command <code>docker images</code> to see the images you have in your local environment.</p>
</div>
<p><img src="img/cloud9-docker-3-build.PNG" class="img-fluid"></p>
<ul>
<li>“Running” the python script requires two steps because the Lambda container is built as a listening service that will execute when there is a payload provided to it.</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The syntax of <code>docker run</code> is as follows:</p>
<pre class="bashrc"><code>
docker run -p PORT CONTAINER NAME

#-p flag specifies which port needs to be used for the container to start running.
# CONTAINER NAME can be anything, we defined it to be lambda-test in this scenario.</code></pre>
</div>
</div>
<ol type="1">
<li>Run the command <code>docker run -p 8080:8080 lambda-test</code> to set up the service on your first terminal tab. This will run the service and listen for triggers. Next, click on the green plus icon and choose <code>New Terminal</code> to launch a new bash terminal.</li>
</ol>
<p><img src="img/cloud9-docker-4-run.PNG" class="img-fluid"></p>
<ol type="1">
<li>In this second terminal, run the command <code>curl -XPOST "http://localhost:8080/2015-03-31/functions/function/invocations" -d '{"payload":"hello world!"}'</code>. This <em>should</em> return the same response as what you saw in the Lambda service. Also, go back to the first terminal tab to see the summary of execution message.</li>
</ol>
<p><img src="img/cloud9-docker-4-result.PNG" class="img-fluid"></p>
</section>
</section>
<section id="lambda-yahoo-finance-exercise-lab-submission-part-2" class="level1">
<h1>Lambda Yahoo Finance Exercise (LAB Submission-Part-2)</h1>
<section id="python-setup" class="level2">
<h2 class="anchored" data-anchor-id="python-setup">Python Setup</h2>
<p>Return the price of any stock symbol that is submitted through the payload value for Lambda. For example, the goal is to get the DOW stock price if I run the command: <code>http://localhost:8080/2015-03-31/functions/function/invocations" -d '{"payload":"DOW"}'</code></p>
<ul>
<li><p>The url has to be dynamic based on the input stock symbol: https://finance.yahoo.com/quote/DOW</p></li>
<li><p>Use the requests and beautifulsoup packages to build the function. Note you will need to add these libraries to the <code>requirements.txt</code> file.</p></li>
<li><p>Start your <code>app.py</code> file with this start code.</p></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> traceback</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="ss">f"https://finance.yahoo.com/quote/DOW"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># need headers to get pull from yahoo finance</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>header <span class="op">=</span> {<span class="st">'Connection'</span>: <span class="st">'keep-alive'</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Expires'</span>: <span class="st">'-1'</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Upgrade-Insecure-Requests'</span>: <span class="st">'1'</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">'User-Agent'</span>: <span class="st">'Mozilla/5.0 (Windows NT 10.0; WOW64) </span><span class="ch">\</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="st">           AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36'</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url, headers<span class="op">=</span>header)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(response.text, <span class="st">"html.parser"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>price <span class="op">=</span> soup.find(<span class="st">"fin-streamer"</span>, {<span class="st">'data-field'</span>:<span class="st">"regularMarketPrice"</span>, <span class="st">'data-symbol'</span> : stock.upper()}).text</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"price=</span><span class="sc">{</span>price<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="coding-requirements" class="level2">
<h2 class="anchored" data-anchor-id="coding-requirements">Coding Requirements:</h2>
<ol type="1">
<li>Add a try-except framework if any part of your code errors. Use the command <code>error=traceback.format_exc()</code> to capture the error. What do you return when the function errors instead?</li>
<li>Ensure that if your function does not receive an input or if it receives an invalid stock ticker that it returns a 404 status code. For no input use the message <code>"No stock provided"</code> and for an invalid ticker choose <code>"Invalid stock provided"</code></li>
<li>Make the url dynamic to the input stock symbol specified</li>
<li>Integrate your code into the Lambda framework - event input and response output</li>
<li>Ensure the response object for a successful request looks like <code>{"statusCode" : 200, "body" : {"stock" : "A", "price" : "#####"}}</code>.</li>
</ol>
<div class="callout-important:">
<p>Please use indent = 2 when dumping the response to make sure the response is easily readable</p>
</div>
<div class="callout-hint">
<p>Hint #1: Try developing using the python console in Cloud9 before integrating into your app.py file. You don’t want to have to build a Docker image every code change, right?</p>
<ul>
<li>This process is mainly only for prototyping. You would do this by writing the entire python code first in app.py file, then running the following command in the terminal :</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> app.py <span class="at">--payload</span> {<span class="st">'payload'</span>: <span class="st">'stock'</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Hint #2: Once you put the code into the Lambda framework, you will have to build and run to complete a development integration.</p>
<p>Hint #3: Implement a basic logger function to see where you might be going wrong? is ther a certain way to pass an input string to the event handler function? Try printing the event out to the console.</p>
</div>
<ol type="1">
<li><p><strong>Use the following test inputs to confirm your function can handle all the errors gracefully: APPL, AAPL, appl, DOW, dow. Unknown tickers need to be handled and case of the ticker should not matter</strong>.</p></li>
<li><p><strong>Submit the bash history where this function is implemented in the file <code>lambda-local-test.txt</code>.</strong></p></li>
<li><p><strong>Once your code is ready to go with Lambda, add, commit, and push the files (app.py, Dockerfile, requirements.txt) to GitHub</strong>.</p></li>
</ol>
</section>
</section>
<section id="deploying-docker-container-as-a-lambda-function" class="level1">
<h1>Deploying Docker Container as a Lambda Function</h1>
<section id="posting-docker-image-to-ecr" class="level2">
<h2 class="anchored" data-anchor-id="posting-docker-image-to-ecr">Posting Docker Image to ECR</h2>
<p>ECR stands for <a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/what-is-ecr.html">Elastic Container Registry</a>.</p>
<ul>
<li><p>Run the command <code>aws ecr create-repository --repository-name docker-lambda</code> to make a new repo in the elastic container registry to store your new containers.</p></li>
<li><p>Run the commands to grab info on your AWS account and region.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>aws_region<span class="op">=</span>$(aws configure get region)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>aws_account_id<span class="op">=</span>$(aws sts get<span class="op">-</span>caller<span class="op">-</span>identity <span class="op">--</span>query <span class="st">'Account'</span> <span class="op">--</span>output text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Run the following command to configure your authentication to talk to the ECR service. Note how we use BASH variable with the <code>$</code> so that you don’t have to manually enter your region or account id.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>aws ecr get<span class="op">-</span>login<span class="op">-</span>password <span class="op">\</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="op">--</span>region $aws_region <span class="op">\</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> docker login <span class="op">\</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="op">--</span>username AWS <span class="op">\</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="op">--</span>password<span class="op">-</span>stdin $aws_account_id.dkr.ecr.$aws_region.amazonaws.com</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Tag the image in the ECR registry by running the command <code>docker tag lambda-docker-build $aws_account_id.dkr.ecr.$aws_region.amazonaws.com/docker-lambda</code></p>
<ul>
<li>The final <code>docker-lambda</code> is referring to the new repository you just built a few commands ago.</li>
</ul></li>
<li><p>Push the image to docker by running the command <code>docker push $aws_account_id.dkr.ecr.$aws_region.amazonaws.com/docker-lambda</code></p></li>
</ul>
<p><img src="img/cloud9-docker-ecr-push.PNG" class="img-fluid"></p>
<p>Read more about pushing a Docker image to ECR <a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/docker-push-ecr-image.html">here</a>.</p>
</section>
<section id="docker-setup-in-lambda" class="level2">
<h2 class="anchored" data-anchor-id="docker-setup-in-lambda">Docker Setup in Lambda</h2>
<p>Go back to the Lambda dashboard by going to this <a href="https://us-east-1.console.aws.amazon.com/lambda/home?region=us-east-1#/discover">link</a>. Make a new function by clicking on the orange <code>Create function</code> button.</p>
<ul>
<li><p>You must select the <code>Container image</code> option that is the third item on the top row of options for Lambda.</p></li>
<li><p>Name your function <code>container-test</code></p></li>
<li><p>Set your <code>Execution role</code> like we did earlier so that you use <code>LabRole</code></p></li>
<li><p>Click on the <code>Browse images</code> button to find the container you just uploaded!</p></li>
</ul>
<p><img src="img/lambda-docker-1-summary.PNG" class="img-fluid"></p>
<ul>
<li>A popup will launch and you have to select the repository (“docker lambda”) and then your image, which will be called “latest” by default. Click on the orange <code>Select image</code> button.</li>
</ul>
<p><img src="img/lambda-docker-0-popup.PNG" class="img-fluid"></p>
<p>Now you see the same overview page for the Lambda. Since this is a container image and not simple code, we cannot actually preview anything. Just click on the <code>Test</code> tab.</p>
<p><img src="img/lambda-docker-2-created.PNG" class="img-fluid"></p>
<p>Set a name for your test <code>aapl-test</code> and change the event JSON to look like <code>{"payload" : "AAPL"}</code>. Once you are satisfied, click on the <code>Save</code> button and then the orange <code>Test</code> button.</p>
<p><img src="img/lambda-docker-3-test.PNG" class="img-fluid"></p>
<p>The result of your test will be shown in a green box, and just click on the <code>Details</code> arrow to see the summary. Note that the stock price came back successfully. The billed duration in the example is <strong>2578 ms</strong>, with “Init duration” contributing <strong>709.68 ms</strong> and the code execution contributing <strong>1867.85 ms</strong>. The results are rounded to the nearest millisecond, but are calculated at the 10 microsecond level, WOW!</p>
<p><img src="img/lambda-docker-4-success.PNG" class="img-fluid"></p>
</section>
</section>
<section id="set-up-function-url-for-a-rest-api" class="level1">
<h1>Set up Function URL for a REST API</h1>
<p>Let’s get the REST API up and running for your Lambda function so that you could call this function with other scripts! Go to the <code>Configuration</code> tab, then the <code>Function URL</code> section, then click <code>Create function URL</code>.</p>
<p><img src="img/lambda-functionurl-page.png" class="img-fluid"></p>
<p>Select <code>NONE</code> as the authentication type. This ensures that anyone with your URL can query the API without security issues. Note this is VERY bad practice if you are in the real world and putting this into production!</p>
<p><img src="img/lambda-functionurl-create.png" class="img-fluid"></p>
<p>Take the <code>Function URL</code> on this page and use as the url for your new REST API. Confirm it work by running it in your browser. It may not work as intended becuase you didn’t provide the Lambda function with an input.</p>
<p><img src="img/lambda-functionurl-confirm.png" class="img-fluid"></p>
<p>Run the following command in Cloud9 to confirm that you are able to query the Function URL properly <code>curl -X POST [YOUR-FUNCTION-URL] -d '{"payload" : "goog"}' --header "Content-Type: application/json"</code>.</p>
<p><img src="img/lambda-functionurl-test.png" class="img-fluid"></p>
<section id="submit-the-lambda-url-in-lambda-docker-url.json-file.-make-sure-that-if-a-payload-is-given-from-the-local-terminal-in-your-laptop-the-lambda-function-returns-the-intended-result." class="level3">
<h3 class="anchored" data-anchor-id="submit-the-lambda-url-in-lambda-docker-url.json-file.-make-sure-that-if-a-payload-is-given-from-the-local-terminal-in-your-laptop-the-lambda-function-returns-the-intended-result.">** Submit the Lambda URL in <code>lambda-docker-url.json</code> file. Make sure that if a payload is given from the local terminal in your laptop, the lambda function returns the intended result.**</h3>
<section id="extra-credit---5-bonus.-modify-your-app.py-to-accept-multiple-stocks-like-payload-aapldowmsft-as-an-input-and-create-a-new-lambda-function.-provide-an-extra-file-in-your-repo-named-bonus-test-url.json-of-your-test.-it-should-return-with-the-given-input-like-the-following-result-below" class="level4">
<h4 class="anchored" data-anchor-id="extra-credit---5-bonus.-modify-your-app.py-to-accept-multiple-stocks-like-payload-aapldowmsft-as-an-input-and-create-a-new-lambda-function.-provide-an-extra-file-in-your-repo-named-bonus-test-url.json-of-your-test.-it-should-return-with-the-given-input-like-the-following-result-below">EXTRA CREDIT - <strong>5% bonus</strong>. Modify your app.py to accept multiple stocks like {“payload” : “AAPL,DOW,MSFT”} as an input and create a new lambda function. Provide an extra file in your repo named <code>bonus-test-url.json</code> of your test. It should return with the given input like the following result below:</h4>
<pre class="bashrc"><code>{"statusCode" : 200,
 "body" : [{"stock" : "A", "price" : "#####"}, {"stock" : "B", "price" : "#####"}]
}</code></pre>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make sure you git add, commit, and push all your work on your container!</p>
</div>
</div>
</section>
</section>
</section>
<section id="run-unit-tests-of-your-rest-api" class="level1">
<h1>Run Unit Tests of your REST API</h1>
<p>Launch Sage Maker Studio, clone your Git repo, and run the jupyter notebook <code>lambda-api-testing.ipynb</code>. DO NOT change any of the cells. This will create a new file called <code>lambda-test.json</code>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/aa1603\.georgetown\.edu\/dsan6000");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Content <i class="fa-brands fa-creative-commons" aria-hidden="true"></i> 2024 by <a href="https://analytics.georgetown.edu/faculty-staff/">Amit Arora, Marck Vaisman, Abhijit Dasgupta</a> <br> All content licensed under a <i class="fa-brands fa-creative-commons" aria-hidden="true"></i> <i class="fa-brands fa-creative-commons-by" aria-hidden="true"></i> <i class="fa-brands fa-creative-commons-nc" aria-hidden="true"></i> <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Made with <i class="fa-brands fa-r-project" aria-hidden="true"></i> and <a href="https://quarto.org/">Quarto</a><br> <a href="https://github.com/gu-dsan/6000-fall-2024.git">View the source at <i class="fa-brands fa-github" aria-hidden="true"></i> GitHub</a></p>
</div>
  </div>
</footer>




</body></html>