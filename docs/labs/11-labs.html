<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Amit Arora">
<meta name="description" content="Analyze Big Data using cloud computing and technologies such as Apache Spark">

<title>PPOL 5206 - Lambda &amp; Docker</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//files/img/ppol5206-logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-N2B9K684GE"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-N2B9K684GE', { 'anonymize_ip': true});
</script>


<meta property="og:title" content="PPOL 5206 - Lambda &amp; Docker">
<meta property="og:description" content="{{< var course.number >}} {{< var course.semester >}}">
<meta property="og:image" content="https://aa1603.georgetown.edu/ppol5206/files/img/ppol5206-logo.png">
<meta property="og:site-name" content="PPOL 5206">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="600">
<meta property="og:image:width" content="518">
<meta name="twitter:title" content="PPOL 5206 - Lambda &amp; Docker">
<meta name="twitter:description" content="{{< var course.number >}} {{< var course.semester >}}">
<meta name="twitter:image" content="https://aa1603.georgetown.edu/ppol5206/files/img/ppol5206-logo.png">
<meta name="twitter:creator" content="@aarora79">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="600">
<meta name="twitter:image-width" content="518">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">PPOL 5206</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../content/index.html">
 <span class="menu-text">Content</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../labs/index.html" aria-current="page">
 <span class="menu-text">Labs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources/index.html">
 <span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://georgetown-ime2320.slack.com"><i class="bi bi-slack" role="img" aria-label="Slack">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Lambda &amp; Docker</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Overview</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/index.html" class="sidebar-item-text sidebar-link">Labs</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Labs content</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/01-labs.html" class="sidebar-item-text sidebar-link">1: Course overview</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/02-labs.html" class="sidebar-item-text sidebar-link">2: Cloud services</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/03-labs.html" class="sidebar-item-text sidebar-link">3: Parallelization</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/04-labs.html" class="sidebar-item-text sidebar-link">4: MapReduce &amp; Hadoop</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/05-labs.html" class="sidebar-item-text sidebar-link">5: Parallel computing with Dask</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/06-labs.html" class="sidebar-item-text sidebar-link">6: Intro to Apache Spark</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/07-labs.html" class="sidebar-item-text sidebar-link">7: Spark SQL &amp; Dataframes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/08-labs.html" class="sidebar-item-text sidebar-link">8: Spark ML</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/09-labs.html" class="sidebar-item-text sidebar-link">9: Spark NLP</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/10-labs.html" class="sidebar-item-text sidebar-link">10: Spark Streaming</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/11-labs.html" class="sidebar-item-text sidebar-link active">11: Serverless &amp; DevOps</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/13-labs.html" class="sidebar-item-text sidebar-link">13: Ray, RAPIDS &amp; DuckDB</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#goals" id="toc-goals" class="nav-link active" data-scroll-target="#goals">Goals</a></li>
  <li><a href="#submitting-the-assignment" id="toc-submitting-the-assignment" class="nav-link" data-scroll-target="#submitting-the-assignment">Submitting the Assignment</a></li>
  <li><a href="#lambda-basics" id="toc-lambda-basics" class="nav-link" data-scroll-target="#lambda-basics">Lambda Basics</a>
  <ul class="collapse">
  <li><a href="#hello-world-lambda" id="toc-hello-world-lambda" class="nav-link" data-scroll-target="#hello-world-lambda">“Hello World” Lambda</a></li>
  <li><a href="#exploring-the-lambda-file-system---todo" id="toc-exploring-the-lambda-file-system---todo" class="nav-link" data-scroll-target="#exploring-the-lambda-file-system---todo">Exploring the Lambda File System - TODO</a>
  <ul class="collapse">
  <li><a href="#use-the-os-or-subprocess-library-in-python-to-view-the-contents-of-the-root-directory.-make-a-new-key-in-the-return-dictionary-and-send-as-the-value-the-contents-of-the-root-directory." id="toc-use-the-os-or-subprocess-library-in-python-to-view-the-contents-of-the-root-directory.-make-a-new-key-in-the-return-dictionary-and-send-as-the-value-the-contents-of-the-root-directory." class="nav-link" data-scroll-target="#use-the-os-or-subprocess-library-in-python-to-view-the-contents-of-the-root-directory.-make-a-new-key-in-the-return-dictionary-and-send-as-the-value-the-contents-of-the-root-directory.">1. Use the <code>os</code> or <code>subprocess</code> library in python to view the contents of the root directory. Make a new key in the return dictionary and send as the value the contents of the root directory.</a></li>
  <li><a href="#return-the-contents-of-the-event-input-variable-to-the-lambda_handler-function-as-additional-item-in-the-return-dictionary" id="toc-return-the-contents-of-the-event-input-variable-to-the-lambda_handler-function-as-additional-item-in-the-return-dictionary" class="nav-link" data-scroll-target="#return-the-contents-of-the-event-input-variable-to-the-lambda_handler-function-as-additional-item-in-the-return-dictionary">2. Return the contents of the event input variable to the lambda_handler function as additional item in the return dictionary</a></li>
  <li><a href="#return-the-contents-of-the-context-input-variable-to-the-lambda_handler-function-as-additional-item-in-the-return-dictionary.-this-might-take-a-few-tries-how-do-you-deal-with-objects-that-need-to-become-strings" id="toc-return-the-contents-of-the-context-input-variable-to-the-lambda_handler-function-as-additional-item-in-the-return-dictionary.-this-might-take-a-few-tries-how-do-you-deal-with-objects-that-need-to-become-strings" class="nav-link" data-scroll-target="#return-the-contents-of-the-context-input-variable-to-the-lambda_handler-function-as-additional-item-in-the-return-dictionary.-this-might-take-a-few-tries-how-do-you-deal-with-objects-that-need-to-become-strings">3. Return the contents of the context input variable to the lambda_handler function as additional item in the return dictionary. This might take a few tries! How do you deal with objects that need to become strings?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#lambda-and-docker" id="toc-lambda-and-docker" class="nav-link" data-scroll-target="#lambda-and-docker">Lambda and Docker</a>
  <ul class="collapse">
  <li><a href="#creating-cloud9-environment" id="toc-creating-cloud9-environment" class="nav-link" data-scroll-target="#creating-cloud9-environment">Creating Cloud9 Environment</a></li>
  <li><a href="#setting-up-basic-docker-images-in-cloud9" id="toc-setting-up-basic-docker-images-in-cloud9" class="nav-link" data-scroll-target="#setting-up-basic-docker-images-in-cloud9">Setting up Basic Docker Images in Cloud9</a></li>
  <li><a href="#lambda-docker-image" id="toc-lambda-docker-image" class="nav-link" data-scroll-target="#lambda-docker-image">Lambda Docker Image</a></li>
  </ul></li>
  <li><a href="#lambda-yahoo-finance-exercise" id="toc-lambda-yahoo-finance-exercise" class="nav-link" data-scroll-target="#lambda-yahoo-finance-exercise">Lambda Yahoo Finance Exercise</a>
  <ul class="collapse">
  <li><a href="#python-setup" id="toc-python-setup" class="nav-link" data-scroll-target="#python-setup">Python Setup</a>
  <ul class="collapse">
  <li><a href="#coding-goals" id="toc-coding-goals" class="nav-link" data-scroll-target="#coding-goals">Coding Goals:</a></li>
  <li><a href="#use-the-following-test-inputs-to-confirm-your-function-can-handle-all-the-errors-gracefully-appl-aapl-appl-dow-dow." id="toc-use-the-following-test-inputs-to-confirm-your-function-can-handle-all-the-errors-gracefully-appl-aapl-appl-dow-dow." class="nav-link" data-scroll-target="#use-the-following-test-inputs-to-confirm-your-function-can-handle-all-the-errors-gracefully-appl-aapl-appl-dow-dow.">Use the following test inputs to confirm your function can handle all the errors gracefully: APPL, AAPL, appl, DOW, dow.</a></li>
  <li><a href="#take-a-screenshot-of-your-terminal-with-all-5-test-cases-and-their-result-and-place-into-your-word-doc" id="toc-take-a-screenshot-of-your-terminal-with-all-5-test-cases-and-their-result-and-place-into-your-word-doc" class="nav-link" data-scroll-target="#take-a-screenshot-of-your-terminal-with-all-5-test-cases-and-their-result-and-place-into-your-word-doc"><strong>Take a screenshot of your terminal with all 5 test cases and their result and place into your Word doc</strong></a></li>
  <li><a href="#once-your-code-is-ready-to-go-with-lambda-add-commit-and-push-the-files-app.py-dockerfile-requirements.txt-to-github.-easiest-way-to-do-this-is-by-downloading-and-uploading-through-the-github-website." id="toc-once-your-code-is-ready-to-go-with-lambda-add-commit-and-push-the-files-app.py-dockerfile-requirements.txt-to-github.-easiest-way-to-do-this-is-by-downloading-and-uploading-through-the-github-website." class="nav-link" data-scroll-target="#once-your-code-is-ready-to-go-with-lambda-add-commit-and-push-the-files-app.py-dockerfile-requirements.txt-to-github.-easiest-way-to-do-this-is-by-downloading-and-uploading-through-the-github-website."><strong>Once your code is ready to go with Lambda, add, commit, and push the files (app.py, Dockerfile, requirements.txt) to GitHub. Easiest way to do this is by downloading and uploading through the GitHub website.</strong></a></li>
  </ul></li>
  <li><a href="#posting-docker-image-to-ecr" id="toc-posting-docker-image-to-ecr" class="nav-link" data-scroll-target="#posting-docker-image-to-ecr">Posting Docker Image to ECR</a></li>
  <li><a href="#docker-setup-in-lambda" id="toc-docker-setup-in-lambda" class="nav-link" data-scroll-target="#docker-setup-in-lambda">Docker Setup in Lambda</a>
  <ul class="collapse">
  <li><a href="#take-a-screenshot-of-the-success-output-from-the-test-you-made-in-lambda-into-your-word-doc" id="toc-take-a-screenshot-of-the-success-output-from-the-test-you-made-in-lambda-into-your-word-doc" class="nav-link" data-scroll-target="#take-a-screenshot-of-the-success-output-from-the-test-you-made-in-lambda-into-your-word-doc"><strong>Take a screenshot of the success output from the test you made in Lambda into your Word doc</strong></a></li>
  <li><a href="#extra-credit---1-points.-modify-your-app.py-to-accept-multiple-stocks-comma-separated-like-payload-aapldowmsft" id="toc-extra-credit---1-points.-modify-your-app.py-to-accept-multiple-stocks-comma-separated-like-payload-aapldowmsft" class="nav-link" data-scroll-target="#extra-credit---1-points.-modify-your-app.py-to-accept-multiple-stocks-comma-separated-like-payload-aapldowmsft">EXTRA CREDIT - <strong>1 points</strong>. Modify your app.py to accept multiple stocks comma separated like {“payload” : “AAPL,DOW,MSFT”}</a></li>
  </ul></li>
  <li><a href="#github-classroom" id="toc-github-classroom" class="nav-link" data-scroll-target="#github-classroom">GitHub Classroom</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header">
<h1 class="title d-none d-lg-block display-7">Lambda &amp; Docker</h1>
<p class="subtitle lead">PPOL 5206 Spring 2024</p>

</header>

<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make sure that you are connected to the <em>Saxanet</em> WiFi network and <em>not</em> the <em>GuestNet</em> network. SSH (TCP port 22) is blocked on GuesNet which means if you are on GuesNet you wil not be able to connect to your cloud VMs or clone repos from GitHub via SSH. <strong>Use SaxaNet</strong>.</p>
</div>
</div>
<section id="goals" class="level1">
<h1>Goals</h1>
<ul>
<li>Write your first Lambda function</li>
<li>Explore the Lambda environment</li>
<li>Build a Docker image</li>
<li>Leverage Docker for your Lambda function</li>
</ul>
</section>
<section id="submitting-the-assignment" class="level1">
<h1>Submitting the Assignment</h1>
<p>Start the lab by opening up a word doc. Save the word doc “LambdaDockerLab-screenshots.docx”</p>
<p>You will follow the submission process for all labs and assignments:</p>
<ul>
<li>Add all your requested files to the GitHub assignment repo for the appropriate deliverable.</li>
<li>Submit a final commit message called “final-submission” to your repo. This is critical so that instructional team can evaluate your work. Do not change your GitHub repo after submitting the “final-submission” commit message</li>
</ul>
<p>Make sure you commit <strong>only the files requested</strong>, and push your repository to GitHub!</p>
<p>Your submission repo requires the following:</p>
<ul>
<li><code>img/</code></li>
<li><code>README.md</code></li>
<li><code>LambdaDockerLab.html</code></li>
<li><code>app.py</code></li>
<li><code>Dockerfile</code></li>
<li><code>requirements.txt</code></li>
<li><code>LambdaDockerLab-screenshots.docx</code></li>
</ul>
</section>
<section id="lambda-basics" class="level1">
<h1>Lambda Basics</h1>
<p>Lambda is a powerful tool to build serverless microfunctions in a variety of programming languages that can be triggered in a variety of ways. The execution of a Lambda can scale to meet the burst needs of users going to a website, or the number of rows of incoming data. There can be thousands of executions happening simultaneously. Lambda is billed by the millisecond (ms).</p>
<section id="hello-world-lambda" class="level2">
<h2 class="anchored" data-anchor-id="hello-world-lambda">“Hello World” Lambda</h2>
<p>Launch AWS Academy and get to the AWS Console. Find the Lambda service from the search bar. <img src="img/lambda-0.PNG" class="img-fluid"></p>
<p>The dashboard shows the Lambda functions that have been made, some metrics on Lambda usage. Click on the orange <code>Create Function</code> button.</p>
<p><img src="img/lambda-1.PNG" class="img-fluid"></p>
<p>Here you have to fill out the details for your Lambda function. There are several parts to set up.</p>
<ol type="1">
<li><p>You will leave the default option <code>Author from scratch</code> so that you can code directly from the Lambda service.</p></li>
<li><p>Set your <code>Function name</code> as <code>my-first-lambda</code>.</p></li>
<li><p>Choose your <code>Runtime</code> as <code>Python 3.9</code></p></li>
<li><p>Click on the <code>Change default execution role</code> dropdown, then select <code>Use an existing role</code> option, and finally pick the existing role <code>LabRole</code>. Once you have done these four things, click on the orange <code>Create function</code> button.</p></li>
</ol>
<p><img src="img/lambda-2.PNG" class="img-fluid"></p>
<p>You now have your environment for Lambda! In the upper function overview tab, you can select a variety of triggers and destinations for the Lambda. We will leave these alone for now. You can explore both on your own time to see the options.</p>
<p>Let’s start with the basic test of the “Hello World” code that was provided in the Python code. Click on the orange <code>Test</code> button.</p>
<p><img src="img/lambda-3.PNG" class="img-fluid"></p>
<p>This will launch a popup to configure your event. You can submit a JSON payload to the test that will mimic input data that the Lambda function can process. Start off by setting <code>Event name</code> to <code>mytest</code>. Then you can leave the <code>Event JSON</code> for now, but you will come back to it for future iterations of experimentation. Click on the orange <code>save</code> button.</p>
<p><img src="img/lambda-4.PNG" class="img-fluid"></p>
<p>Click on the orange <code>test</code> button again. If you click on the arrow then you can choose to change or make a new test environment like you did on the previous step.</p>
<p><img src="img/lambda-5.PNG" class="img-fluid"></p>
<p>Your test will execute, and the results will be shown. Several pieces of info are important:</p>
<ul>
<li>Name of the test that was conducted</li>
<li>Response object that the function returned</li>
<li>Function logs that include the duration of the function, billed direction, memory max (for pricing), and actual memory used</li>
<li>Status in the upper right</li>
</ul>
<p><img src="img/lambda-6.PNG" class="img-fluid"></p>
<p>OPTIONAL - If you wanted to set your Lambda to run on a regular schedule, like a crontab, you will need to add a trigger using EventBridge (CloudWatch Events). The Trigger add would look like this for setting a job to run every day at 10:15am UTC.</p>
<p><img src="img/lambda-trigger-cron.PNG" class="img-fluid"></p>
</section>
<section id="exploring-the-lambda-file-system---todo" class="level2">
<h2 class="anchored" data-anchor-id="exploring-the-lambda-file-system---todo">Exploring the Lambda File System - TODO</h2>
<p>In this section, you will store three screenshots in your Word doc to show the Lambda responses from a variety of code changes to your Lambda handler function.</p>
<p>Each time you make a change to the code, you will have to click on the <code>Deploy</code> button and then the orange <code>Test</code> button.</p>
<p><img src="img/lambda-7-codechange.PNG" class="img-fluid"></p>
<section id="use-the-os-or-subprocess-library-in-python-to-view-the-contents-of-the-root-directory.-make-a-new-key-in-the-return-dictionary-and-send-as-the-value-the-contents-of-the-root-directory." class="level3">
<h3 class="anchored" data-anchor-id="use-the-os-or-subprocess-library-in-python-to-view-the-contents-of-the-root-directory.-make-a-new-key-in-the-return-dictionary-and-send-as-the-value-the-contents-of-the-root-directory.">1. Use the <code>os</code> or <code>subprocess</code> library in python to view the contents of the root directory. Make a new key in the return dictionary and send as the value the contents of the root directory.</h3>
</section>
<section id="return-the-contents-of-the-event-input-variable-to-the-lambda_handler-function-as-additional-item-in-the-return-dictionary" class="level3">
<h3 class="anchored" data-anchor-id="return-the-contents-of-the-event-input-variable-to-the-lambda_handler-function-as-additional-item-in-the-return-dictionary">2. Return the contents of the event input variable to the lambda_handler function as additional item in the return dictionary</h3>
</section>
<section id="return-the-contents-of-the-context-input-variable-to-the-lambda_handler-function-as-additional-item-in-the-return-dictionary.-this-might-take-a-few-tries-how-do-you-deal-with-objects-that-need-to-become-strings" class="level3">
<h3 class="anchored" data-anchor-id="return-the-contents-of-the-context-input-variable-to-the-lambda_handler-function-as-additional-item-in-the-return-dictionary.-this-might-take-a-few-tries-how-do-you-deal-with-objects-that-need-to-become-strings">3. Return the contents of the context input variable to the lambda_handler function as additional item in the return dictionary. This might take a few tries! How do you deal with objects that need to become strings?</h3>
</section>
</section>
</section>
<section id="lambda-and-docker" class="level1">
<h1>Lambda and Docker</h1>
<p>The easiest method to set up our Docker image for Lambda is using Cloud9! Follow the steps below to get Cloud9 set up.</p>
<section id="creating-cloud9-environment" class="level2">
<h2 class="anchored" data-anchor-id="creating-cloud9-environment">Creating Cloud9 Environment</h2>
<ol type="1">
<li>Search for <code>cloud9</code> in the search bar of your AWS console as shown in the figure below.</li>
</ol>
<p><img src="img/cloud9_step0.PNG" class="img-fluid"></p>
<ol start="2" type="1">
<li>Once on the Cloud9 splash screen, click on the orange button <code>Create environment</code>.</li>
</ol>
<p><img src="img/cloud9_step1.PNG" class="img-fluid"></p>
<ol start="3" type="1">
<li>Enter a Name and description for your environment. The figure below shows sample text you could use. Once you enter your name and description click the orange button <code>Next step</code>.</li>
</ol>
<p><img src="img/cloud9_step2.PNG" class="img-fluid"></p>
<ol start="4" type="1">
<li>There are a few options here. You can leave all of the defaults. Click the orange <code>Next step</code> button.
<ul>
<li>The <strong>Environment type</strong> section lets you pick if you want to spin up a new EC2 machine or connect to existing resources.</li>
<li>The <strong>Instance type</strong> section is to select how large an instance for Cloud9. The small t2.micro instance is fine for Cloud9.</li>
<li>The <strong>Platform</strong> section is for selecting the operating system for your new instance.</li>
<li>The <strong>Cost-saving setting</strong> option is set so your instance will hibernate after 30 minutes so you are not charged for the instance 24/7. This is a major problem for cloud services because you can run up a bill quite quickly!</li>
<li>The <strong>IAM role</strong> is for managing permissions to AWS resources like S3. Cloud9 setup will make a new role automatically.</li>
</ul></li>
</ol>
<p><img src="img/cloud9_step3.PNG" class="img-fluid"></p>
<ol start="5" type="1">
<li>This screen shows the summary of the selections made for naming and configuring the environment. Click the orange <code>Create environment</code> button.</li>
</ol>
<p><img src="img/cloud9_step4.PNG" class="img-fluid"></p>
<ol start="6" type="1">
<li>The environment will be configured for you. This takes a few minutes.</li>
</ol>
<p><img src="img/cloud9_step5.PNG" class="img-fluid"></p>
<p>Once the environment setup screen goes away then you are ready to use Cloud9. If you get a warning message, just click “OK”.</p>
</section>
<section id="setting-up-basic-docker-images-in-cloud9" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-basic-docker-images-in-cloud9">Setting up Basic Docker Images in Cloud9</h2>
<p>Docker image building in Cloud9 is easy since the docker package is already set up. You just have to write some code and run Linux commands!</p>
<ul>
<li><p>Start off by making a new folder on the lefthand folder sidebar. Call it something simple like <code>docker-lambda-env</code>.</p></li>
<li><p>Once you have the folder created, create three files in that folder called <code>Dockerfile</code>, <code>app.py</code>, and <code>requirements.txt</code>.</p></li>
<li><p>The results should look like the below and have the symbols change automatically:</p></li>
</ul>
<p><img src="img/cloud9-docker-0.PNG" class="img-fluid"></p>
<ul>
<li>Open up the Dockerfile and add the following text (note the # lines are comments just like python!)</li>
</ul>
<pre><code># syntax=docker/dockerfile:1

# adapted from https://www.philschmid.de/aws-lambda-with-custom-docker-image
# https://docs.aws.amazon.com/lambda/latest/dg/python-image.html
FROM python:3.9-slim-buster

CMD ["python", "-c", "import platform; print(f\"version: {platform.python_version()}\")"]</code></pre>
<ul>
<li>Go to the terminal and change directories to the location of your Dockerfile. Run the command <code>docker build ./ -t test</code></li>
</ul>
<p><img src="img/cloud9-docker-1-build.PNG" class="img-fluid"></p>
<ul>
<li>Run the command <code>docker run test</code> to see if your Dockerfile worked!</li>
</ul>
<p><img src="img/cloud9-docker-1-run.PNG" class="img-fluid"></p>
</section>
<section id="lambda-docker-image" class="level2">
<h2 class="anchored" data-anchor-id="lambda-docker-image">Lambda Docker Image</h2>
<ul>
<li>Use the new Dockerfile contents below for your Dockerfile. Note that this Dockerfile is invoking your requirements.txt file to install any packages from pip and the app.py lambda_handler function to run the python code.</li>
</ul>
<pre><code># syntax=docker/dockerfile:1

# adapted from https://www.philschmid.de/aws-lambda-with-custom-docker-image
# https://docs.aws.amazon.com/lambda/latest/dg/python-image.html
FROM public.ecr.aws/lambda/python:3.9

# copy requirements file and install necessary packages
ADD requirements.txt ${LAMBDA_TASK_ROOT}
RUN pip3 install -r ${LAMBDA_TASK_ROOT}/requirements.txt --target "${LAMBDA_TASK_ROOT}"

# Copy function code to docker container
COPY app.py ${LAMBDA_TASK_ROOT}

# app (name of py file)
# handler (name of function to execute for lambda job)
CMD [ "app.lambda_handler" ]</code></pre>
<ul>
<li><p>Note that the ADD and COPY commands in Docker for this instance are similar. The ADD function is more advanced and can auto-extract compressed files into the image.</p></li>
<li><p>Set up your python file <code>app.py</code> with a function called <code>lambda_handler</code> that accepts the <code>event</code> and <code>context</code> arguments. Wait, we have already done this in basic Lambda! Copy your function from the Lambda service. This will ensure that the response is the same through basic Lambda and through the Docker Lambda.</p></li>
</ul>
<p><img src="img/cloud9-docker-2-lambda.PNG" class="img-fluid"></p>
<ul>
<li>Since you made changes to the Dockerfile and your app.py files, you need to build a new Docker image. Run the command <code>docker build ./ -t lambda-test</code>.</li>
</ul>
<p><img src="img/cloud9-docker-3-build.PNG" class="img-fluid"></p>
<ul>
<li>“Running” the python script requires two steps because the Lambda container is built as a listening service that will execute when there is a payload provided to it.</li>
</ul>
<ol type="1">
<li>Run the command <code>docker run -p 8080:8080 lambda-test</code> to set up the service on your first terminal tab. This will run the service and listen for triggers. Next, click on the green plus icon and choose <code>New Terminal</code> to launch a new bash terminal.</li>
</ol>
<p><img src="img/cloud9-docker-4-run.PNG" class="img-fluid"></p>
<ol start="2" type="1">
<li>In this second terminal, run the command <code>curl -XPOST "http://localhost:8080/2015-03-31/functions/function/invocations" -d '{"payload":"hello world!"}'</code>. This <em>should</em> return the same response as what you saw in the Lambda service. Also, go back to the first terminal tab to see the summary of execution message.</li>
</ol>
<p><img src="img/cloud9-docker-4-result.PNG" class="img-fluid"></p>
</section>
</section>
<section id="lambda-yahoo-finance-exercise" class="level1">
<h1>Lambda Yahoo Finance Exercise</h1>
<section id="python-setup" class="level2">
<h2 class="anchored" data-anchor-id="python-setup">Python Setup</h2>
<p>Return the price of any stock symbol that is submitted through the payload value for Lambda. For example, I would get the DOW stock price if I ran the command: <code>http://localhost:8080/2015-03-31/functions/function/invocations" -d '{"payload":"DOW"}'</code></p>
<ul>
<li><p>The url has to be dynamic based on the input stock symbol: https://finance.yahoo.com/quote/DOW</p></li>
<li><p>Use the requests and beautifulsoup packages to build the function. Note you will need to add these libraries to the <code>requirements.txt</code> file.</p></li>
<li><p>The starter code looks like this:</p></li>
</ul>
<pre><code># import libraries
import requests
from bs4 import BeautifulSoup

# set url
url = f"https://finance.yahoo.com/quote/DOW"

# get the url page results
response = requests.get(url)

# try to parse Beautiful Soup
try:
    soup = BeautifulSoup(response.text, "html.parser")
except Exception as e: # handle error gracefully
    return {
        'statusCode': 200,
        'body': json.dumps(f'Here is the error message: {e}'),
        } # send the error message back to the user

# find the price
price = soup.find("fin-streamer", {'data-test':"qsp-price"}).text

print(price)</code></pre>
<section id="coding-goals" class="level3">
<h3 class="anchored" data-anchor-id="coding-goals">Coding Goals:</h3>
<ul>
<li>Add try-except framework if the find does not work. What do you return instead?</li>
<li>Make the url dynamic to the input stock symbol specified</li>
<li>Integrate your code into the Lambda framework - event input and response output</li>
</ul>
<p>Hint #1: Try developing using the python console in Cloud9 before integrating into your app.py file.</p>
<p>Hint #2: Once you put the code into the Lambda framework, you will have to build and run to run a development integration.</p>
</section>
<section id="use-the-following-test-inputs-to-confirm-your-function-can-handle-all-the-errors-gracefully-appl-aapl-appl-dow-dow." class="level3">
<h3 class="anchored" data-anchor-id="use-the-following-test-inputs-to-confirm-your-function-can-handle-all-the-errors-gracefully-appl-aapl-appl-dow-dow.">Use the following test inputs to confirm your function can handle all the errors gracefully: APPL, AAPL, appl, DOW, dow.</h3>
</section>
<section id="take-a-screenshot-of-your-terminal-with-all-5-test-cases-and-their-result-and-place-into-your-word-doc" class="level3">
<h3 class="anchored" data-anchor-id="take-a-screenshot-of-your-terminal-with-all-5-test-cases-and-their-result-and-place-into-your-word-doc"><strong>Take a screenshot of your terminal with all 5 test cases and their result and place into your Word doc</strong></h3>
</section>
<section id="once-your-code-is-ready-to-go-with-lambda-add-commit-and-push-the-files-app.py-dockerfile-requirements.txt-to-github.-easiest-way-to-do-this-is-by-downloading-and-uploading-through-the-github-website." class="level3">
<h3 class="anchored" data-anchor-id="once-your-code-is-ready-to-go-with-lambda-add-commit-and-push-the-files-app.py-dockerfile-requirements.txt-to-github.-easiest-way-to-do-this-is-by-downloading-and-uploading-through-the-github-website."><strong>Once your code is ready to go with Lambda, add, commit, and push the files (app.py, Dockerfile, requirements.txt) to GitHub. Easiest way to do this is by downloading and uploading through the GitHub website.</strong></h3>
</section>
</section>
<section id="posting-docker-image-to-ecr" class="level2">
<h2 class="anchored" data-anchor-id="posting-docker-image-to-ecr">Posting Docker Image to ECR</h2>
<p>ECR stands for <a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/what-is-ecr.html">Elastic Container Registry</a>.</p>
<ul>
<li><p>Run the command <code>aws ecr create-repository --repository-name docker-lambda</code> to make a new repo in the elastic container registry to store your new containers.</p></li>
<li><p>Run the command <code>$(aws ecr get-login --no-include-email --region us-east-1)</code> to grab the login information for your AWS account and store on the Cloud9 EC2 instance. This is bad practice for important accounts, but this account is just for experimenting!</p></li>
<li><p>Run the command <code>cat /home/ec2-user/.docker/config.json</code> to see the contents of the authentication file. Copy the address that looks similar to <code>565177075063.dkr.ecr.us-east-1.amazonaws.com</code></p></li>
<li><p>Tag the image with the ECR registry by running the command <code>docker tag lambda-test [[THE URL YOU FOUND IN THE LAST STEP]]/docker-lambda</code></p>
<ul>
<li>The example looks like <code>docker tag lambda-test 565177075063.dkr.ecr.us-east-1.amazonaws.com/docker-lambda</code></li>
<li>Note that you have to use your own account id, not the one in the example text!</li>
<li>The final <code>docker-lambda</code> is referring to the new repository you just built a few commands ago.</li>
</ul></li>
<li><p>Push the image to docker by running the command <code>docker push 565177075063.dkr.ecr.us-east-1.amazonaws.com/docker-lambda</code></p></li>
</ul>
<p><img src="img/cloud9-docker-ecr-push.PNG" class="img-fluid"></p>
<p>Read more about pushing a Docker image to ECR <a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/docker-push-ecr-image.html">here</a>.</p>
</section>
<section id="docker-setup-in-lambda" class="level2">
<h2 class="anchored" data-anchor-id="docker-setup-in-lambda">Docker Setup in Lambda</h2>
<p>Go back to the Lambda dashboard by going to this link: https://us-east-1.console.aws.amazon.com/lambda/home?region=us-east-1#/discover. Make a new function by clicking on the orange <code>Create function</code> button.</p>
<ul>
<li><p>You must select the <code>Container image</code> option that is the third item on the top row of options for Lambda.</p></li>
<li><p>Name your function <code>container-test</code></p></li>
<li><p>Set your <code>Execution role</code> like we did earlier so that you use <code>LabRole</code></p></li>
<li><p>Click on the <code>Browse images</code> button to find the container you just uploaded!</p></li>
</ul>
<p><img src="img/lambda-docker-1-summary.PNG" class="img-fluid"></p>
<ul>
<li>A popup will launch and you have to select the repository (“docker lambda”) and then your image, which will be called “latest” by default. Click on the orange <code>Select image</code> button.</li>
</ul>
<p><img src="img/lambda-docker-0-popup.PNG" class="img-fluid"></p>
<p>Now you see the same overview page for the Lambda. Since this is a container image and not simple code, we cannot actually preview anything. Just click on the <code>Test</code> tab.</p>
<p><img src="img/lambda-docker-2-created.PNG" class="img-fluid"></p>
<p>Set a name for your test <code>aapl-test</code> and change the event JSON to look like <code>{"payload" : "AAPL"}</code>. Once you are satisfied, click on the <code>Save</code> button and then the orange <code>Test</code> button.</p>
<p><img src="img/lambda-docker-3-test.PNG" class="img-fluid"></p>
<p>The result of your test will be shown in a green box, and just click on the <code>Details</code> arrow to see the summary. Note that the stock price came back successfully. The billed duration in the example is <strong>2578 ms</strong>, with “Init duration” contributing <strong>709.68 ms</strong> and the code execution contributing <strong>1867.85 ms</strong>. The results are rounded to the nearest millisecond, but are calculated at the 10 microsecond level, WOW!</p>
<p><img src="img/lambda-docker-4-success.PNG" class="img-fluid"></p>
<section id="take-a-screenshot-of-the-success-output-from-the-test-you-made-in-lambda-into-your-word-doc" class="level3">
<h3 class="anchored" data-anchor-id="take-a-screenshot-of-the-success-output-from-the-test-you-made-in-lambda-into-your-word-doc"><strong>Take a screenshot of the success output from the test you made in Lambda into your Word doc</strong></h3>
</section>
<section id="extra-credit---1-points.-modify-your-app.py-to-accept-multiple-stocks-comma-separated-like-payload-aapldowmsft" class="level3">
<h3 class="anchored" data-anchor-id="extra-credit---1-points.-modify-your-app.py-to-accept-multiple-stocks-comma-separated-like-payload-aapldowmsft">EXTRA CREDIT - <strong>1 points</strong>. Modify your app.py to accept multiple stocks comma separated like {“payload” : “AAPL,DOW,MSFT”}</h3>
</section>
</section>
<section id="github-classroom" class="level2">
<h2 class="anchored" data-anchor-id="github-classroom">GitHub Classroom</h2>
<p><a href="https://classroom.github.com/a/yFvXUYP9">GitHub Classroom Link</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content <i class="fa-brands fa-creative-commons" aria-hidden="true"></i> 2024 by <a href="https://www.linkedin.com/in/amit-arora-539120a/">Amit Arora</a> <br> All content licensed under a <i class="fa-brands fa-creative-commons" aria-hidden="true"></i> <i class="fa-brands fa-creative-commons-by" aria-hidden="true"></i> <i class="fa-brands fa-creative-commons-nc" aria-hidden="true"></i> <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-right">Made with <i class="fa-brands fa-r-project" aria-hidden="true"></i> and <a href="https://quarto.org/">Quarto</a><br> <a href="https://github.com/gu-ppol/ppol5206s24-class-site.git">View the source at <i class="fa-brands fa-github" aria-hidden="true"></i> GitHub</a></div>
  </div>
</footer>



</body></html>